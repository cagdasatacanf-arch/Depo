# Planning

You are an autonomous coding agent. Your task is to create or update an implementation plan based on the PRD and existing code.

## Paths
- PRD: /home/user/Depo/.agents/tasks/prd.md
- Implementation Plan: /home/user/Depo/.ralph/IMPLEMENTATION_PLAN.md
- AGENTS (optional): /home/user/Depo/AGENTS.md
- Progress Log: /home/user/Depo/.ralph/progress.md
- Guardrails: /home/user/Depo/.ralph/guardrails.md
- Guardrails Reference: /home/user/Depo/.agents/ralph/references/GUARDRAILS.md
- Context Reference: /home/user/Depo/.agents/ralph/references/CONTEXT_ENGINEERING.md
- Errors Log: /home/user/Depo/.ralph/errors.log
- Activity Log: /home/user/Depo/.ralph/activity.log
- Repo Root: /home/user/Depo

## Rules (Non-Negotiable)
- Do NOT implement anything.
- Do NOT run tests or modify source code.
- Do NOT ask the user questions.
- Plan only.
- Do NOT assume missing functionality; confirm by reading code.
- Treat shared utilities (if present) as the standard library; prefer existing patterns over ad-hoc copies.

## Your Task (Do this in order)
1. Read the PRD at /home/user/Depo/.agents/tasks/prd.md.
2. Read /home/user/Depo/.ralph/guardrails.md for known failure modes (follow them while planning).
3. If /home/user/Depo/AGENTS.md exists, read it for project-specific commands/patterns.
4. Inspect relevant code to compare reality vs requirements. Do not assume missing functionality.
5. Look for TODOs, placeholders, skipped/flaky tests, and inconsistent patterns.
6. Ensure each story heading in the PRD uses the exact marker format: `### [ ] US-XXX: Story Title` (checked stories: `### [x] ...`).
   - If the markers are incorrect, update /home/user/Depo/.agents/tasks/prd.md to fix only the heading markers (do not change meaning).
   - Ensure a short **Routing Policy** section exists in the PRD; add it if missing (see template below).
7. Create or update /home/user/Depo/.ralph/IMPLEMENTATION_PLAN.md with a prioritized task list, grouped by story.

## Implementation Plan Format (Required)
Use a simple markdown structure with self-contained tasks grouped by story:

- Each story has its own section: `### US-XXX: Story Title`.
- Use the exact story IDs/titles from the PRD.
- Each task is a single checkbox item `- [ ]`.
- Each task must be self-contained and independently shippable.
- Each task must include **what**, **where**, and **verification**.

Example task format:

- [ ] Task title
  - Scope: what you will change and where (files/modules)
  - Acceptance: concrete outcomes to verify
  - Verification: exact command(s) to run

Also include a short summary at the top:

# Implementation Plan

## Summary
- Brief overview of gaps and the next most important work

## Tasks
### US-XXX: Story Title
- [ ] ...

## Notes
- Discoveries, risks, or clarifications

## Output
- Update /home/user/Depo/.ralph/IMPLEMENTATION_PLAN.md.
- You may also update /home/user/Depo/.agents/tasks/prd.md only to fix story heading markers and to add/maintain the **Routing Policy** section.

## Additional Guardrails
- Plan only. No implementation.
- Keep tasks ordered by priority of missing work.
- If you discover a missing requirement, note it under **Notes** and add a task.

## Routing Policy Template (PRD)
Add this section to the PRD if missing (keep it short and explicit):

## Routing Policy
- Commit URLs are invalid.
- Unknown GitHub subpaths canonicalize to repo root.
